# 性能测试应该怎么做
## 测试报告里的主要问题
* 用的都是平均值
* 响应时间没有和吞吐量TPS/QPS 挂钩
* 响应时间和吞吐量没有和成功率挂钩
## 测试数据的表示方法 
* 平均数 
	* 噪点
* 中位数 
* 百分比分布统计
## 为什么响应时间要和吞吐量挂钩
* 脱离响应时间的吞吐量毫无意义
  随着并发量的上涨，系统会变得越来越不稳定，响应时间的波动也会变得越来越大,相应事件也会变得越来越慢，而吞吐率越来越上不去，cpu的使用率也会如此。
## 如何正确的做性能测试
* 定义一个系统的响应时间，百分比分布，成功率。  
99.9的响应时间必须在1ms之内，平均乡音时间在1ms之内，100%的请求成功。
* 在这个响应时间的限制下，找到最高的吞吐量 
测试的数据需要有大中小各种尺寸的数据，按比例混合。最好符合现实。
* 在这个吞吐量做净泡测试
49h,168h 稳定性测试
* 找到系统的极限值  
在成功率100%的情况下（不考虑响应时间的长短），系统能坚持10分钟,或者小时的吞吐量
* 做脉冲测试（爆破测试,破裂测试） 
稳定值 跑5分钟，极限值 跑一分钟，如此反复测试一段时间。	
* 低吞吐量和网络小包的测试。 
低吞吐量 可能会导致latency上升, 比如TCP_NODEALY 没有打开
## 告警
* 当系统的吞吐量达到系统的稳定值的多少，需要产生告警
比如把超过系统吞吐量66.7%作为告警的低水位线，系统吞吐量的80%作为告警的高水位线 
## 关注的数据
* Server Information
    G10, G9 or G8
* Performance Data

| throughput | latency | Top Percentile | Success rate |  CPU  | Memory |   IO   | Bandwidth |  Duration |  Scenario  |
| -----------|:-------:|:--------------:|:------------:|:-----:|:------:|:------:|:---------:|:---------:|:---------- |
|   20000    |  `20ms` |   **99%**      |  **99.9%%**  |  80%  |  76%   |  89%   |    70%    |    49h    |    link?   |
|            |         |                |              |       |        |        |           |           |            |
## 常见问题
* 为什么平均值不靠谱
	* 平均工资，平均房价，平均支出。
	例子，我和马云的年薪平均下，我也是亿万富翁了。

## 参考文献 
* [性能测试应该怎么做](https://coolshell.cn/articles/17381.html/comment-page-1#comments)
* [why Average suck and percentiles are great](https://www.dynatrace.com/news/blog/why-averages-suck-and-percentiles-are-great/)
